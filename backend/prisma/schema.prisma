// backend/prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  // provider = "sqlite"
  // url = "file:./dev.db"
}

model Campaign {
  id                String      @id @default(cuid())
  name              String
  tokenMint         String
  tokenDecimals     Int
  sourceTokenAccount String
  authorityWallet   String
  mode              String      // "cost-saver" or "high-assurance"
  batchSize         Int         @default(20)
  maxRetries        Int         @default(3)
  status            String      @default("pending") // pending, running, paused, completed, failed
  totalRecipients   Int         @default(0)
  totalSent         Int         @default(0)
  totalConfirmed    Int         @default(0)
  totalFailed       Int         @default(0)
  totalSOLSpent     Decimal     @default(0) @db.Decimal(20, 9)
  createdAt         DateTime    @default(now())
  updatedAt         DateTime    @updatedAt
  
  recipients        Recipient[]
}

model Recipient {
  id              String    @id @default(cuid())
  campaignId      String
  campaign        Campaign  @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  address         String
  amount          Decimal   @db.Decimal(20, 9)
  status          String    @default("pending") // pending, sent, confirmed, failed, retrying
  txSignature     String?
  feesPaid        Decimal?  @db.Decimal(20, 9)
  attempts        Int       @default(0)
  lastError       String?
  confirmedAt     DateTime?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  
  @@index([campaignId])
  @@index([status])
}